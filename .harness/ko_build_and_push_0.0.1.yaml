template:
  name: ko build and push
  type: Step
  spec:
    type: Run
    spec:
      connectorRef: <+input>
      image: kameshsampath/kube-dev-tools:0.1.5
      shell: Bash
      command: |-
        echo "$IMAGE_REGISTRY_PASSWORD" | ko login "$IMAGE_REGISTRY" -u  "$IMAGE_REGISTRY_USERNAME" --password-stdin
        image_digests=$(ko build --bare \
          --image-label="org.opencontainers.image.source=<+codebase.repoUrl>" \
          --tags="$IMAGE_TAG" \
          --platform=linux/amd64 \
          --platform=linux/arm64)
      envVariables:
        IMAGE_TAG: <+input>
        KO_DOCKER_REPO: <+input>
        IMAGE_REGISTRY: <+input>
        IMAGE_REGISTRY_USERNAME: <+input>
        IMAGE_REGISTRY_PASSWORD: <+input>
      outputVariables:
        - name: image_digests
      imagePullPolicy: IfNotPresent
    description: Builds a go application using ko and pushes the image to repo set via $KO_DOCKER_REPO
  identifier: ko_build_and_push
  description: Builds a go application using ko and pushes the image to repo KO_DOCKER_REPO
  versionLabel: 0.0.1
  tags: {}
  icon: data:image/png;base64,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
